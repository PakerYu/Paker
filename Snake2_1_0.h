#pragma once

#ifndef __SNAKE_2_1_0_H
#define __SNAKE_2_1_0_H

#include <stdio.h>
#include <Windows.h>
#include <stdlib.h>
#include <time.h>
#include <conio.h>
#include <math.h>
#include <easyx.h>
#include <TChar.h>
#include <tchar.h>
#include <graphics.h>
#include <math.h>

#define OriginalLength 3	//???????????

#define Border 20   //???(??¦Ë:????)
#define xNet 30     //x?????????(0~29)
#define yNet 30     //y?????????(0~29)
#define Gap 3       //??????????(??¦Ë:????)
#define EdgeLenth 20    //??????(????gap)


#define Width  (xNet * EdgeLenth + 2 * Border)   //???????
#define Height  (yNet * EdgeLenth + 2 * Border)  //??????
#define winWidth  (Width + 200)	//???????

//??????????????
#define UP		0
#define DOWN	1
#define LEFT	2
#define RIGHT	3

//?????
struct SnakeInfo
{
	boolean alive;	//???????
	boolean isstatus;
	int length;		//????????
	int direction;	//?????????????
	int score;		//????
};

//??????????(???????????????)
struct Section
{
	int num;                //?????
	int x;                  //???x????
	int y;					//???y????
	int Gx;					//Graphic x
	int Gy;					//Graphic y
	int direction;          //??????????
	struct Section* pre;	//???????? (?????????) 
	struct Section* next;   //????????
};
#define Section_Size sizeof(struct Section)

//????????
struct Button
{
	int x;
	int y;
	int width;
	int height;
	COLORREF color;
	TCHAR* pText;
};

//??????
struct FoodInfo
{
	int x;
	int y;
};

//??????????
struct Refresh
{
	int frequency;	//?????????
	int fresh_number;	//?????????
	struct Period
	{
		clock_t screen;	//??????????
		clock_t status;	//?????????
	}period;
};

typedef struct Anime_Info
{
	boolean isaction;			//???????§Ø???
	int anime_freshed_number;	//??????????
	int pixel_pre_step;			//????????????
}AnimeInfo;

//?????????
typedef struct Time_Record
{
	clock_t previous_time;	//????????????
	clock_t latter_time;	//?????????????
}TimeRecord;



extern clock_t NewTime, PreTime;
extern clock_t ANTime, AFTime;

extern struct SnakeInfo Snake;

extern struct Section *left, * head, *tail;      
/*
*head ???????
*tail ?????????
*left ????????????????
*??????? next ????? left
* left ?? next ? NULL
* head ?? pre ? NULL
*/

extern struct FoodInfo food;

extern struct Refresh RefreshInfo;

extern TimeRecord Screen_Time, Status_Time;

extern AnimeInfo Anime;

//????????
#define NextSection(x) x=x->next
//????????
#define PreSection(x) x=x->pre

/************************************************************/
/******************************???????***********************/
//????????
void initWin(int width, int height, COLORREF bkcolor);

//??????
void PrintFood();

//??????????
void PrintMap();

//???????
void ScoreShow();

//???????????
int toPixel(int Net);

//????????
int EndScreen();

//??????
void ClickCheck(int, int, int, int, const TCHAR* , COLORREF);

//?????????
void loadBar();

//??????????
void SecPrint(struct Section*, COLORREF);

//???????
void showTitle();

//????·Ú
void showVersion();

//???????
void showRules();

//??????????????????
void added_Section_Print(struct Section*, COLORREF);

//????§µ??, ?????????????????§µ?÷“??
void print_Verify(struct Section*);

/**********************************************************/
/****************************??????***********************/

//??????
int toPixel(int);

//???????????????
struct Section* searchSection(int);

//??????????
void Period_Calculate(struct Refresh*);

//?????þ—?????????????
int timeOffset(TimeRecord*, clock_t);

//Section?????????(head?????????)
void directInherit(struct Section*);

//???????, ??num?x??????????, x=-1???¦Â??
struct Section* CreateSection(int);

/*
* ??????
* return: 1????????, 0????????
*/
int crashCheck();

/*
* ???????????
* return: 1 ?????????, 0 ?????§Ô??
*/
int foodCheck();

/*
*???????(???????????)
* end_section: ???????????
*/
void coordinatesRefresh(struct Section* end_section);

//??????????
void pixel_Compute_Print(struct Section*);

//Snake????????
void SnakeStructure_Init(struct SnakeInfo*);

/**********************************************************/
/*************************????(?????)????*******************/

//RefreshInfo(??????)?????
void RefreshStructure_Init(struct Refresh*);

//Anime????????
void AnimeStructure_Init(AnimeInfo*);

//Time_Record????????
void timeStructure_Init();

#endif // !_SNAKE_2_1_0_H
